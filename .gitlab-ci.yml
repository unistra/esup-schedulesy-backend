stages:
  - test

services:
  - postgres:9.5

variables:
  POSTGRES_DB: schedulesy
  POSTGRES_USER: schedulesy
  POSTGRES_PASSWORD: schedulesy
  PYTHON_VERSION: "3.7"

include:
  - remote: https://git.unistra.fr/docker/template/-/raw/main/black.gitlab-ci.yml

unittest:
  stage: test
  tags:
    - cluster
  image: unistra/python3.7-ci:latest
  script:
    - pip3 install -r requirements/dev.txt
    - tox -e py37

safety:
  stage: test
  tags:
    - cluster
  image: unistra/python3.7-ci:latest
  script:
    - pip3 install -r requirements/dev.txt
    - safety check
  only:
    - main
    - develop
